var weak=require("weak"),test=require("tap").test,LRU=require("../"),l=new LRU({max:10}),refs=0;function X(){refs++;weak(this,deref)}function deref(){refs--}test("no leaks",function(b){for(var a=0;100>a;a++)l.set(a,new X),0===a%2&&l.get(a/2);gc();for(var c=process.memoryUsage(),d=refs,a=0;1E4>a;a++)l.set(a,new X),0===a%2&&l.get(a/2);gc();a=process.memoryUsage();b.equal(refs,d,"no leaky refs");console.error("start: %j\nend:   %j",c,a);b.pass();b.end()});
