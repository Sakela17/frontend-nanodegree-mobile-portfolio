var test=require("tap").test,LRU=require("../");test("dump",function(a){var b=new LRU;a.equal(b.dump().length,0,"nothing in dump for empty cache");b.set("a","A");b.set("b","B");a.deepEqual(b.dump(),[{k:"b",v:"B",e:0},{k:"a",v:"A",e:0}]);b.set("a","A");a.deepEqual(b.dump(),[{k:"a",v:"A",e:0},{k:"b",v:"B",e:0}]);b.get("b");a.deepEqual(b.dump(),[{k:"b",v:"B",e:0},{k:"a",v:"A",e:0}]);b.del("a");a.deepEqual(b.dump(),[{k:"b",v:"B",e:0}]);a.end()});
test("do not dump stale items",function(a){var b=new LRU({max:5,maxAge:50});b.set("a","A");setTimeout(function(){b.set("b","B");var c=b.dump();a.equal(c.length,2);a.equal(c[0].k,"b");a.equal(c[1].k,"a")},25);setTimeout(function(){b.set("c","C");var c=b.dump();a.equal(c.length,2);a.equal(c[0].k,"c");a.equal(c[1].k,"b")},60);setTimeout(function(){b.set("d","D",40);var c=b.dump();a.equal(c.length,2);a.equal(c[0].k,"d");a.equal(c[1].k,"c")},90);setTimeout(function(){var c=b.dump();a.equal(c.length,1);
a.equal(c[0].k,"d")},120);setTimeout(function(){var c=b.dump();a.deepEqual(c,[]);a.end()},155)});test("load basic cache",function(a){var b=new LRU,c=new LRU;b.set("a","A");b.set("b","B");c.load(b.dump());a.deepEquals(b.dump(),c.dump());a.end()});
test("load staled cache",function(a){var b=new LRU({maxAge:50}),c=new LRU({maxAge:50}),d;b.set("a","A");setTimeout(function(){b.set("b","B");d=b.dump();a.equal(d.length,2)},30);setTimeout(function(){c.load(d);a.equal(c.get("a"),void 0);a.equal(c.get("b"),"B")},60);setTimeout(function(){a.equal(c.get("b"),void 0);a.end()},90)});
test("load to other size cache",function(a){var b=new LRU({max:2}),c=new LRU({max:1});b.set("a","A");b.set("b","B");c.load(b.dump());a.equal(c.get("a"),void 0);a.equal(c.get("b"),"B");b.get("a");c.load(b.dump());a.equal(c.get("a"),"A");a.equal(c.get("b"),void 0);a.end()});
test("load to other age cache",function(a){var b=new LRU({maxAge:50}),c=new LRU({maxAge:100}),d=new LRU,e;b.set("a","A");setTimeout(function(){b.set("b","B");b.set("c","C",70);e=b.dump();a.equal(e.length,3)},20);setTimeout(function(){a.equal(b.get("a"),void 0);a.equal(b.get("b"),"B");a.equal(b.get("c"),"C");c.load(e);a.equal(c.get("a"),void 0);a.equal(c.get("b"),"B");a.equal(c.get("c"),"C");d.load(e);a.equal(d.get("a"),void 0);a.equal(d.get("b"),"B");a.equal(d.get("c"),"C")},60);setTimeout(function(){a.equal(b.get("a"),
void 0);a.equal(b.get("b"),void 0);a.equal(b.get("c"),"C");c.load(e);a.equal(c.get("a"),void 0);a.equal(c.get("b"),void 0);a.equal(c.get("c"),"C");d.load(e);a.equal(d.get("a"),void 0);a.equal(d.get("b"),void 0);a.equal(d.get("c"),"C")},80);setTimeout(function(){a.equal(b.get("a"),void 0);a.equal(b.get("b"),void 0);a.equal(b.get("c"),void 0);c.load(e);a.equal(c.get("a"),void 0);a.equal(c.get("b"),void 0);a.equal(c.get("c"),void 0);d.load(e);a.equal(d.get("a"),void 0);a.equal(d.get("b"),void 0);a.equal(d.get("c"),
void 0);a.end()},100)});
