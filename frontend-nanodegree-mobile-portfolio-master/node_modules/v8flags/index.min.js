var os=require("os"),fs=require("fs"),path=require("path"),crypto=require("crypto"),execFile=require("child_process").execFile,env=process.env,user=env.LOGNAME||env.USER||env.LNAME||env.USERNAME||"",exclusions=["--help"],configfile=".v8flags."+process.versions.v8+"."+crypto.createHash("md5").update(user).digest("hex")+".json",failureMessage="Unable to cache a config file for v8flags to a your home directory\nor a temporary folder. To fix this problem, please correct your\nenvironment by setting HOME=/path/to/home or TEMP=/path/to/temp.\nNOTE: the user running this must be able to access provided path.\nIf all else fails, please open an issue here:\nhttp://github.com/tkellen/js-v8flags";
function fail(a){a.message+="\n\n"+failureMessage;return a}function openConfig(a){var b=require("user-home");if(!b)return tryOpenConfig(path.join(os.tmpdir(),configfile),a);tryOpenConfig(path.join(b,configfile),function(b,c){return b?tryOpenConfig(path.join(os.tmpdir(),configfile),a):a(null,c)})}function tryOpenConfig(a,b){try{var d=require(a);process.nextTick(function(){b(null,d)})}catch(c){fs.open(a,"w+",function(a,c){return a?b(a):b(null,c)})}}
function getFlags(a){execFile(process.execPath,["--v8-options"],function(b,d){if(b)return a(b);b=d.match(/\s\s--(\w+)/gm).map(function(a){return a.substring(2)}).filter(function(a){return-1===exclusions.indexOf(a)});return a(null,b)})}function writeConfig(a,b,d){var c=new Buffer(JSON.stringify(b));return fs.write(a,c,0,c.length,0,function(c){fs.close(a,function(a){return(a=c||a)?d(fail(a),b):d(null,b)})})}
module.exports=function(a){if(process.versions&&process.versions.electron)return process.nextTick(function(){a(null,[])});openConfig(function(b,d){if(!b&&"number"!==typeof d)return a(null,d);getFlags(function(c,e){return c?a(c):b?a(fail(b),e):writeConfig(d,e,a)})})};module.exports.configfile=configfile;
