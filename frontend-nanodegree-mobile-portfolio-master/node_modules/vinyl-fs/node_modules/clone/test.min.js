null===module.parent&&(console.log("Run this test file with nodeunit:"),console.log("$ nodeunit test.js"));var clone=require("./"),util=require("util"),_=require("underscore");exports["clone string"]=function(a){a.expect(2);var b="foo";a.strictEqual(clone(b),b);b="";a.strictEqual(clone(b),b);a.done()};
exports["clone number"]=function(a){a.expect(5);var b=0;a.strictEqual(clone(b),b);b=1;a.strictEqual(clone(b),b);b=-1E3;a.strictEqual(clone(b),b);b=3.1415927;a.strictEqual(clone(b),b);b=-3.1415927;a.strictEqual(clone(b),b);a.done()};exports["clone date"]=function(a){a.expect(3);var b=new Date,c=clone(b);a.ok(b instanceof Date);a.ok(c instanceof Date);a.equal(c.getTime(),b.getTime());a.done()};
exports["clone object"]=function(a){a.expect(2);var b={foo:{bar:"baz"}},c=clone(b);a.ok(_(b).isEqual(c),"underscore equal");a.deepEqual(c,b);a.done()};exports["clone array"]=function(a){a.expect(2);var b=[{foo:"bar"},"baz"],c=clone(b);a.ok(_(b).isEqual(c),"underscore equal");a.deepEqual(c,b);a.done()};exports["clone buffer"]=function(a){a.expect(1);var b=new Buffer("this is a test buffer"),c=clone(b);a.deepEqual(c,b);a.done()};
exports["clone regexp"]=function(a){a.expect(5);var b=/abc123/gi,c=clone(b);a.deepEqual(c,b);b=/a/g;a.ok(0===b.lastIndex);b.exec("123a456a");a.ok(4===b.lastIndex);b=clone(b);a.ok(b.global);a.ok(4===b.lastIndex);a.done()};exports["clone object containing array"]=function(a){a.expect(2);var b={arr1:[{a:"1234",b:"2345"}],arr2:[{c:"345",d:"456"}]},c=clone(b);a.ok(_(b).isEqual(c),"underscore equal");a.deepEqual(c,b);a.done()};
exports["clone object with circular reference"]=function(a){function b(a,b){return util.inspect(a,!0,null)===util.inspect(b,!0,null)}a.expect(8);var c=a.ok,d=[1,"foo",{hello:"bar"},function(){},!1,[2]],e={b:[d,2,3,4],c:d};e.loop=e;e.loop2=e;d.loop=d;d.aloop=e;d=clone(e);c(e!=d);c(e.c!=d.c);c(d.c==d.b[0]);c(d.c.loop.loop.aloop==d);c(d.c[0]==e.c[0]);c(b(e,d));d.c[0]=2;c(!b(e,d));d.c="2";c(!b(e,d));a.done()};
exports.clonePrototype=function(a){a.expect(3);var b={a:"aaa",x:123,y:45.65},c=clone.clonePrototype(b);a.strictEqual(c.a,b.a);a.strictEqual(c.x,b.x);a.strictEqual(c.y,b.y);a.done()};exports.cloneWithinNewVMContext=function(a){a.expect(3);var b=require("vm"),c=b.createContext({clone:clone}),b=b.runInContext("clone( {array: [1, 2, 3], date: new Date(), regex: /^foo$/ig} );",c);a.ok(b.array instanceof Array);a.ok(b.date instanceof Date);a.ok(b.regex instanceof RegExp);a.done()};
exports.cloneObjectWithNoConstructor=function(a){a.expect(3);var b={foo:"bar",__proto__:null};a.ok("object"===typeof b);a.ok(!0);var c=clone(b);a.ok(b.foo,c.foo);a.done()};exports["clone object with depth argument"]=function(a){a.expect(6);var b={foo:{bar:{baz:"qux"}}},c=clone(b,!1,1);a.deepEqual(c,b);a.notEqual(c,b);a.strictEqual(c.foo,b.foo);c=clone(b,!0,2);a.deepEqual(c,b);a.notEqual(c.foo,b.foo);a.strictEqual(c.foo.bar,b.foo.bar);a.done()};
exports["maintain prototype chain in clones"]=function(a){a.expect(1);var b=new function(){},c=clone(b);a.strictEqual(Object.getPrototypeOf(b),Object.getPrototypeOf(c));a.done()};exports["parent prototype is overriden with prototype provided"]=function(a){a.expect(1);var b=new function(){},b=clone(b,!0,Infinity,null);a.strictEqual(b.__defineSetter__,void 0);a.done()};
exports["clone object with null children"]=function(a){a.expect(1);var b={foo:{bar:null,baz:{qux:!1}}},c=clone(b);a.deepEqual(c,b);a.done()};exports["clone instance with getter"]=function(a){function b(){}a.expect(1);Object.defineProperty(b.prototype,"prop",{configurable:!0,enumerable:!0,get:function(){return"value"}});var c=new b,c=clone(c);a.strictEqual(c.prop,"value");a.done()};
