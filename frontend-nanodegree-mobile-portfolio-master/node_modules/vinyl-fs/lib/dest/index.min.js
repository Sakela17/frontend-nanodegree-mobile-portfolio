var defaults=require("defaults"),path=require("path"),through2=require("through2"),mkdirp=require("mkdirp"),fs=require("graceful-fs"),writeContents=require("./writeContents");
function dest(c,a){a=a||{};if("string"!==typeof c&&"function"!==typeof c)throw Error("Invalid output folder");var d=defaults(a,{cwd:process.cwd()});"string"===typeof d.mode&&(d.mode=parseInt(d.mode,8));var f=path.resolve(d.cwd);a=through2.obj(function(b,a,h){var e;"string"===typeof c&&(e=path.resolve(f,c));"function"===typeof c&&(e=path.resolve(f,c(b)));var g=path.resolve(e,b.relative);a=path.dirname(g);b.stat=b.stat?b.stat:new fs.Stats;b.stat.mode=d.mode||b.stat.mode;b.cwd=f;b.base=e;b.path=g;mkdirp(a,
function(a){if(a)return h(a);writeContents(g,b,h)})});a.resume();return a}module.exports=dest;
