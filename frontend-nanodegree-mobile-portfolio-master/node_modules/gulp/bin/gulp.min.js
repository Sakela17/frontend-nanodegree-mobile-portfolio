var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var e=d++;return{value:b(e,a[e]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var gutil=require("gulp-util"),prettyTime=require("pretty-hrtime"),chalk=require("chalk"),semver=require("semver"),archy=require("archy"),Liftoff=require("liftoff"),tildify=require("tildify"),interpret=require("interpret"),v8flags=require("v8flags"),completion=require("../lib/completion"),argv=require("minimist")(process.argv.slice(2)),taskTree=require("../lib/taskTree");process.env.INIT_CWD=process.cwd();
var cli=new Liftoff({name:"gulp",completions:completion,extensions:interpret.jsVariants,v8flags:v8flags}),failed=!1;process.once("exit",function(a){0===a&&failed&&process.exit(1)});var cliPackage=require("../package"),versionFlag=argv.v||argv.version,tasksFlag=argv.T||argv.tasks,tasks=argv._,toRun=tasks.length?tasks:["default"],simpleTasksFlag=argv["tasks-simple"],shouldLog=!argv.silent&&!simpleTasksFlag;shouldLog||(gutil.log=function(){});
cli.on("require",function(a){gutil.log("Requiring external module",chalk.magenta(a))});cli.on("requireFail",function(a){gutil.log(chalk.red("Failed to load external module"),chalk.magenta(a))});cli.on("respawn",function(a,b){a=chalk.magenta(a.join(", "));b=chalk.magenta(b.pid);gutil.log("Node flags detected:",a);gutil.log("Respawned to PID:",b)});cli.launch({cwd:argv.cwd,configPath:argv.gulpfile,require:argv.require,completion:argv.completion},handleArguments);
function handleArguments(a){versionFlag&&0===tasks.length&&(gutil.log("CLI version",cliPackage.version),a.modulePackage&&"undefined"!==typeof a.modulePackage.version&&gutil.log("Local version",a.modulePackage.version),process.exit(0));a.modulePath||(gutil.log(chalk.red("Local gulp not found in"),chalk.magenta(tildify(a.cwd))),gutil.log(chalk.red("Try running: npm install gulp")),process.exit(1));a.configPath||(gutil.log(chalk.red("No gulpfile found")),process.exit(1));semver.gt(cliPackage.version,
a.modulePackage.version)&&(gutil.log(chalk.red("Warning: gulp version mismatch:")),gutil.log(chalk.red("Global gulp is",cliPackage.version)),gutil.log(chalk.red("Local gulp is",a.modulePackage.version)));process.cwd()!==a.cwd&&(process.chdir(a.cwd),gutil.log("Working directory changed to",chalk.magenta(tildify(a.cwd))));require(a.configPath);gutil.log("Using gulpfile",chalk.magenta(tildify(a.configPath)));var b=require(a.modulePath);logEvents(b);process.nextTick(function(){if(simpleTasksFlag)return logTasksSimple(a,
b);if(tasksFlag)return logTasks(a,b);b.start.apply(b,toRun)})}function logTasks(a,b){b=taskTree(b.tasks);b.label="Tasks for "+chalk.magenta(tildify(a.configPath));archy(b).split("\n").forEach(function(a){0!==a.trim().length&&gutil.log(a)})}function logTasksSimple(a,b){console.log(Object.keys(b.tasks).join("\n").trim())}function formatError(a){return a.err?"boolean"===typeof a.err.showStack?a.err.toString():a.err.stack?a.err.stack:Error(String(a.err)).stack:a.message}
function logEvents(a){a.on("err",function(){failed=!0});a.on("task_start",function(a){gutil.log("Starting","'"+chalk.cyan(a.task)+"'...")});a.on("task_stop",function(a){var b=prettyTime(a.hrDuration);gutil.log("Finished","'"+chalk.cyan(a.task)+"'","after",chalk.magenta(b))});a.on("task_err",function(a){var b=formatError(a),c=prettyTime(a.hrDuration);gutil.log("'"+chalk.cyan(a.task)+"'",chalk.red("errored after"),chalk.magenta(c));gutil.log(b)});a.on("task_not_found",function(a){gutil.log(chalk.red("Task '"+
a.task+"' is not in your gulpfile"));gutil.log("Please check the documentation for proper gulpfile formatting");process.exit(1)})};
