var path=require("path"),test=require("tape"),resolve=require("../");
test("mock",function(a){function c(b){return{basedir:path.resolve(b),isFile:function(b,a){a(null,Object.prototype.hasOwnProperty.call(e,path.resolve(b)))},readFile:function(b,a){a(null,e[path.resolve(b)])}}}a.plan(8);var e={};e[path.resolve("/foo/bar/baz.js")]="beep";resolve("./baz",c("/foo/bar"),function(b,d,c){if(b)return a.fail(b);a.equal(d,path.resolve("/foo/bar/baz.js"));a.equal(c,void 0)});resolve("./baz.js",c("/foo/bar"),function(b,d,c){if(b)return a.fail(b);a.equal(d,path.resolve("/foo/bar/baz.js"));
a.equal(c,void 0)});resolve("baz",c("/foo/bar"),function(b,d){a.equal(b.message,"Cannot find module 'baz' from '"+path.resolve("/foo/bar")+"'");a.equal(b.code,"MODULE_NOT_FOUND")});resolve("../baz",c("/foo/bar"),function(b,d){a.equal(b.message,"Cannot find module '../baz' from '"+path.resolve("/foo/bar")+"'");a.equal(b.code,"MODULE_NOT_FOUND")})});
test("mock from package",function(a){function c(b){return{basedir:path.resolve(b),isFile:function(b,a){a(null,Object.prototype.hasOwnProperty.call(e,b))},"package":{main:"bar"},readFile:function(b,a){a(null,e[b])}}}a.plan(8);var e={};e[path.resolve("/foo/bar/baz.js")]="beep";resolve("./baz",c("/foo/bar"),function(b,d,c){if(b)return a.fail(b);a.equal(d,path.resolve("/foo/bar/baz.js"));a.equal(c&&c.main,"bar")});resolve("./baz.js",c("/foo/bar"),function(b,c,e){if(b)return a.fail(b);a.equal(c,path.resolve("/foo/bar/baz.js"));
a.equal(e&&e.main,"bar")});resolve("baz",c("/foo/bar"),function(b,c){a.equal(b.message,"Cannot find module 'baz' from '"+path.resolve("/foo/bar")+"'");a.equal(b.code,"MODULE_NOT_FOUND")});resolve("../baz",c("/foo/bar"),function(b,c){a.equal(b.message,"Cannot find module '../baz' from '"+path.resolve("/foo/bar")+"'");a.equal(b.code,"MODULE_NOT_FOUND")})});
test("mock package",function(a){a.plan(2);var c={};c[path.resolve("/foo/node_modules/bar/baz.js")]="beep";c[path.resolve("/foo/node_modules/bar/package.json")]=JSON.stringify({main:"./baz.js"});resolve("bar",function(a){return{basedir:path.resolve(a),isFile:function(b,a){a(null,Object.prototype.hasOwnProperty.call(c,path.resolve(b)))},readFile:function(b,a){a(null,c[path.resolve(b)])}}}("/foo"),function(c,b,d){if(c)return a.fail(c);a.equal(b,path.resolve("/foo/node_modules/bar/baz.js"));a.equal(d&&
d.main,"./baz.js")})});
test("mock package from package",function(a){a.plan(2);var c={};c[path.resolve("/foo/node_modules/bar/baz.js")]="beep";c[path.resolve("/foo/node_modules/bar/package.json")]=JSON.stringify({main:"./baz.js"});resolve("bar",function(a){return{basedir:path.resolve(a),isFile:function(a,d){d(null,Object.prototype.hasOwnProperty.call(c,path.resolve(a)))},"package":{main:"bar"},readFile:function(a,d){d(null,c[path.resolve(a)])}}}("/foo"),function(c,b,d){if(c)return a.fail(c);a.equal(b,path.resolve("/foo/node_modules/bar/baz.js"));
a.equal(d&&d.main,"./baz.js")})});
