var core=require("./core"),fs=require("fs"),path=require("path"),caller=require("./caller.js"),nodeModulesPaths=require("./node-modules-paths.js");
module.exports=function(a,g){function h(d){if(k(d))return d;for(var c=0;c<m.length;c++){var b=d+m[c];if(k(b))return b}}function l(d){var c=path.join(d,"/package.json");if(k(c)){c=n(c,"utf8");try{var b=JSON.parse(c);f.packageFilter&&(b=f.packageFilter(b,d));if(b.main){var a=h(path.resolve(d,b.main));if(a)return a;var e=l(path.resolve(d,b.main));if(e)return e}}catch(q){}}return h(path.join(d,"/index"))}function p(a,c){c=nodeModulesPaths(c,f);for(var b=0;b<c.length;b++){var d=c[b],e=h(path.join(d,"/",
a));if(e)return e;if(d=l(path.join(d,"/",a)))return d}}if("string"!==typeof a)throw new TypeError("Path must be a string.");var f=g||{},k=f.isFile||function(a){try{var c=fs.statSync(a)}catch(b){if(b&&("ENOENT"===b.code||"ENOTDIR"===b.code))return!1;throw b;}return c.isFile()||c.isFIFO()},n=f.readFileSync||fs.readFileSync,m=f.extensions||[".js"];g=f.basedir||path.dirname(caller());f.paths=f.paths||[];if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(a)){var e=path.resolve(g,a);if(".."===a||"/"===a.slice(-1))e+=
"/";e=h(e)||l(e)}else e=p(a,g);if(e)return e;if(core[a])return a;a=Error("Cannot find module '"+a+"' from '"+g+"'");a.code="MODULE_NOT_FOUND";throw a;};
